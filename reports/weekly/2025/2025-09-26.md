# 週報

## 今週の作業概要
- YES/NO 占いアプリに統計ダッシュボード機能を追加  
- 別PC環境でも起動できるように、DockerfileやCompose設定を整理

## 躓いた点と経緯
1. **フロントのビルド失敗**
   - `npm install` 時に `/app/package.json` が見つからずエラー  
   - 原因：Dockerfile がルートを参照しており、`web/` 配下構成と不一致

2. **複数クローン・サブモジュール化の混乱**
   - 同じリポジトリを複数の場所に clone → ポート競合や rebase 競合  
   - `web/` がサブモジュール化されており rebase で衝突多発

3. **DB 接続タイミングエラー**
   - API 起動時に DB がまだ ready でなく `ECONNREFUSED`  
   - 毎回 API を再起動しないと安定しなかった

4. **README の不備**
   - 初回の DB テーブル作成コマンドが Bash 前提で PowerShell では動かない  
   - 他の人がそのまま試すとエラーになる恐れ

## 解決の流れ
- Dockerfile を `web/Dockerfile.web` と `api/Dockerfile.api` に分割  
- `web/docker-compose.yml` を基点とし、build context を正しく設定  
- DB に `healthcheck` を追加し、API は DB が healthy になるまで待機  
- README を更新し、**web 配下で compose 実行**することを明記  

## 結果
- 自分の環境・他の人の環境ともに `docker compose up -d --build` で安定起動可能  
- Web: http://localhost:5173/  
- 統計ダッシュボード: http://localhost:5173/#/admin  
- API: http://localhost:8080/api/health → `{"ok":true}`  

