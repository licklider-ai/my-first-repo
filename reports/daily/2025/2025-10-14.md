## 本日の作業
### 1. 評価スクリプト整備
- `eval20.sh`：依存確認、ランダムサンプリング、指数バックオフ、キャッシュ、集計を実装・安定化。  
- `merge_and_report.sh`：複数 run のマージ、費用算出、カテゴリ別集計、Misses 抜粋、Markdown レポート生成。  
- 出力先デフォルトをトップレベル `reports/` に設定。

### 2. 実行と初期分析（モデル：gpt-4o-mini）
- 単発 run（例：`runs/20251014_112434`）  
  - **正答率**：80.00%  
  - **概算費用**：$0.15555（in=$0.11715, out=$0.03840）
- 複数 run を統合（合計 80 サンプル）  
  - **総正答率**：**77.50%**  
  - **トークン**：Prompt 3124 / Completion 252  
  - **概算費用**：**$0.61980**（in=$0.46860, out=$0.15120）
- **カテゴリ別（80サンプル）**  
  - coding: **100%**（16/16）  
  - knowledge: **83.33%**（20/24）  
  - devops: **25%**（2/8）  
  - lang: **0%**（0/4）  
  - logic: **0%**（0/4）

### 3. レポート出力
- 生成物：`reports/20251014_135654/`
  - `report.md`, `all_results.(tsv|csv)`, `per_category.tsv`, `misses.tsv`
- Misses 代表例・要因  
  - `docker ps` にバッククォート付与 → 正規表現で不一致  
  - yes/no 出力の句読点ゆらぎ  
  - 英語短文で末尾ピリオド有無の差

### 4. リポジトリ反映
- ブランチ  
  - `feature/evalbench-20251014`：スクリプト & runs & 初期レポート追加  
  - `reports/eval-20251014-135654`：トップ `reports/` に成果物複製  
- push 済み（PR は未作成。GitHub CLI 未導入のため）

### 5. マルチプロバイダ対応（着手）
- `eval20_multi.sh` 下書き開始（OpenAI / 他社対応の枠組み、未完成）

### 6. Gemini 連携の検証
- API キー準備・疎通（`gemini-2.5-pro` の `ping` 成功）。  
- ZIP マニフェスト（inlineData）要約：`MAX_TOKENS` 到達や `503` 過負荷で安定せず。  
- 対策方針のみ整理（軽量化・出力制約・リトライ・二段階サマリ）。

---

## 成果物・コミット
- スクリプト：  
  - `evalbench/eval20.sh`  
  - `evalbench/merge_and_report.sh`（出力先デフォルト変更）  
- レポート：  
  - `reports/20251014_135654/` 一式  
- ブランチ：  
  - `feature/evalbench-20251014`  
  - `reports/eval-20251014-135654`  

---

## 課題
- **devops / logic / lang の正答率が低い**  
  - 正規表現の厳格さ（バッククォート・句読点・大文字小文字）起因が目立つ。
- **Gemini 要約の安定性**  
  - 長文投入で `MAX_TOKENS`、混雑で `503`。プロンプト設計と軽量化が必要。
- **PR 未作成**  
  - ツール未導入のため保留。

---

## 明日の対応（ToDo）
1. **評価セット修正**：受け入れ幅を広げる（例：`^thank\s*you\.?$`、`^(はい|yes)[。.]?$`、コマンドのバッククォート無視）。  
2. **レポート改善**：Misses に原因タグ（`regex-strict` / `punct` / `case`）付与、ラン別・モデル別比較の表追加。  
3. **Gemini 安定化**：軽量マニフェスト生成、出力制約（箇条数/行長/本文のみ）、`2.5-flash` フォールバック、必要に応じて二段階サマリ。  
4. **マルチプロバイダ版仕上げ**：`eval20_multi.sh` 完成、集計に `provider` / `model` 軸を追加。  
5. **PR 作成**：GitHub CLI 導入 or ブラウザから 2 本の PR を起票。

---

## 所感
- OpenAI 側はリトライ・経路安定化で復旧可。  
- Gemini はモデル名・キー種別の確認が重要。`2.5-pro` の品質は良いが混雑時は `2.5-flash` が堅実。  
- 現状 77.5% は**表現ゆらぎ**に引きずられている印象で、評価ルーブリック（正規表現）の改善余地が大きい。
