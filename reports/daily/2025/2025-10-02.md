# 日報 (2025-10-02)

## 作業内容1
- Docker環境でアプリのクリーン起動を実施  
  - `docker compose down -v` → DB 初期化  
  - `docker compose up -d --build` → Web / API / DB の再起動  
- API の動作確認  
  - `/api/health` で `{"ok":true}` を確認  
  - `curl` によるログ保存・集計の確認を実施  
- フロントエンドのデバッグ  
  - Docker の web コンテナで `vite preview` を使用  
  - `--host 0.0.0.0` オプションが必要なことを確認  
  - 修正方法（`web/package.json` に追記 or 一時対応コマンド）を整理  

## 詰まった点
- フロントエンドにアクセスした際、`ERR_EMPTY_RESPONSE` が発生  
- 原因は `vite preview` がコンテナ内で `127.0.0.1` にバインドされていたため  
- 対処として `--host 0.0.0.0` を指定して解決可能であることを確認  

## 今後の対応
- `web/package.json` の `preview` スクリプトを修正し、再ビルドで恒久対応  
- 修正後にフロント (`http://localhost:5173`) から動作確認を再度実施  
- ダッシュボードやリセットボタンの動作を含めて最終確認予定


## 作業内容2
- **LogicBench ベースの GPT 評価環境の立ち上げと配線確認**
- **WSL/VS Code 環境でスターター一式を展開**
  - `logicbench_env_starter_plus.zip` を解凍し、`~/dev/logicbench_env` をルートに設定
- **Python 仮想環境と依存導入**
  - `.venv` 作成、`pip install -r requirements.txt` 実施（pandas/pydantic/typer 等）
- **評価パイプラインの動作確認（DRY-RUN）**
  - `run_eval → score → report` を実行し、**acc=1.0 / avg_latency_ms=0 / n=2** を確認
  - 生成物：`runs/dev_raw.jsonl`, `runs/dev_scored.csv`, `reports/summary.csv`
- **スコアラーの頑健化（軽微改修）**
  - `score.py` をフォールバック対応（`parsed` 無しでも `raw_text` から抽出）に差し替え

## つまずいた点と対処
1) **VS Code で ZIP をテキストとして開こうとして警告**
   - 対処：ZIP は解凍してフォルダをルートで開く運用に統一
2) **Windows パスを WSL に渡してエラー（`C:\...`）**
   - 対処：`/mnt/c/...` 形式へ置換、または `wslpath` で変換
3) **`file -i` の使い方（オプションとパスの間のスペース欠落）**
   - 対処：`file -i <path>` の正しいシンタックスで再実行
4) **初回の Acc=0（本番モード試行時）**
   - 原因：OpenAI から **401 invalid_api_key**。`.env` に重複行/不可視文字混入が発覚
   - 対処：
     - `.env` の重複行を削除（`OPENAI_API_KEY` は1行のみ）
     - キーの長さ/先頭/不可視文字の検査スクリプトで判定
     - 「浄化」コマンド（非ASCII/改行除去）で再生成
   - 結果：最終的に **APIキー未発行の方針**に切り替え、**DRY-RUN固定**で配線確認を完了

## 現在の状態
- **環境**：`/home/<user>/dev/logicbench_env` で安定稼働（WSL）
- **実行**：DRY-RUN で一周（成功）。実APIは未実施
- **スコア**：`acc=1.0 / avg_latency_ms=0 / n=2`（ダミー出力の想定どおり）
- **課題**：実APIでの数値（真の精度/レイテンシ/コスト）は未計測

## リスク・注意点
- `.env` の取り扱い（**Git に含めない／共有しない**）
- APIキー貼付時の不可視文字混入（Windows/ブラウザコピーで起こりやすい）

## 次の予定
- **DRY-RUNで配線検証を継続**
  - 自前データの 10–30% サンプルで `run_eval → score → report` を運用
  - `runs/*_scored.csv` をスプレッドシートにインポートして共有欄（承認/日付）を追加
- **本番計測に入るタイミングでのみ API キー発行**
  - `.env` に `OPENAI_API_KEY=sk-...` を1行で保存（空白/引用符/重複なし）
  - 実APIで再実行し、誤答の上位 3 パターンを抽出 → プロンプト 1 点改善で A/B

