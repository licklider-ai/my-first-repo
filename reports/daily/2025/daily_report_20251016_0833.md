# 日報（2025-10-16 08:33）

## 概要
- 目的：math で 100% 正答の運用を **logic / knowledge / devops** に拡張し、ローカル（4o 系）と Gemini で評価可能な環境を整備。
- 成果：
  - 4o-mini の小規模テスト（各2問）で **3カテゴリとも 100%** を確認。
  - 壊れていた評価パイプラインを修正（プロンプト整備、スクリプト補修、採点形式の統一）。
  - **配布用バンドル tar.gz** と **Gemini 向け最小 ZIP（階層なし）** を生成。
  - レポートをコミットしてブランチ `report/2025-10-16` に push（PR 可能）。
  - Gemini 側の 60問フル運用を想定した **トークン/コスト概算**を取り込み。

## 実施内容（作業ログ）
- `logicbench_env` セットアップ／修復
  - `scripts/eval_runner.py` で **choices/letters 判定・単一トークン抽出**の堅牢化を確認。
  - 変換器（dev/gold → runner 形式）を組み込み、`run_categories.sh` を改修して **一時ファイルを経由**し確実に採点まで回るように修正。
  - `scripts/score_simple_local.py` を追加（`output`/`pred` どちらでも採点可能）。
- 評価実行（4o-mini）
  - `./run_categories.sh logic knowledge devops` を実行。
  - 結果（各2問）：**logic/knowledge/devops = 100%**（要注意：サンプル極小）。
- レポートとリポジトリ更新
  - `reports/Eval_Report_20251016_155135.md` を生成しコミット。
  - `.gitignore` 追加（`runs/`, `dist/`, 一時 JSONL, summary CSV などを除外）→ 汚染防止。
  - SSH エージェント設定の上、`report/2025-10-16` ブランチを push。
- 配布物
  - **tar バンドル**: `dist/logicbench_runner_YYYYMMDD_HHMMSS.tar.gz`
  - **Gemini フラット ZIP**: `dist/gemini_flat_YYYYMMDD_HHMMSS.zip`
    - 内容：`dev_*.jsonl / gold_*.jsonl / run_gemini.py / README_GEMINI.md`
    - AI Studio/Colab で **解凍 → 複数ファイルを直接アップロード**して `!python run_gemini.py` 実行。
- Gemini の 60問フル実行を想定した概算（提供メモより）
  - 入力 ~ **7,500 tokens**、出力 ~ **3,000 tokens**（合計 ~10,500）
  - 試算コスト：
    - Gemini 1.5 Pro: **~$0.058**/回
    - Claude 3.5 Sonnet: **~$0.068**/回

## テスト結果（本日）
- モデル：`gpt-4o-mini`、英語強制・**単一トークン**回答の厳格プロンプト
- 小規模結果（各2問）
  - logic: 2/2（100%）
  - knowledge: 2/2（100%）
  - devops: 2/2（100%）
- math：既報どおり 4o 系で **100%** を維持

> 注意：小標本のため、**60問フル評価での再検証が必要**。

## つまずいた点 / 対応
1. **ヒアドキュメント（`<<MD` 等）での入力停止** → ヒアドキュメント不使用の生成方式（`printf`/Python）に統一。
2. **`score_and_cost_simple.py` と出力形式の不整合** → `score_simple_local.py` を導入し `output/pred` 自動対応で解消。
3. **未トラッキング生成物の氾濫** → `.gitignore` で `runs/`、`dist/`、一時 JSONL、CSV を除外。
4. **SSH push 時のパスフレーズ・URL 問題** → `ssh-agent` + `ssh-add`、`origin` の URL 確認で解消。
5. **Gemini が ZIP を直接開けない** → **階層なしのフラット ZIP**に再構成し、解凍後に複数ファイルをアップロードする運用へ。

## リスクと留意
- 4o 側の 100% は各2問の参考値。**60問**による統計的評価が必要。
- 日本語→英語強制に伴うニュアンス損失の可能性。モデル間での指示遵守差を観測予定。
- DevOps は環境差で解釈が揺れやすいため、問題文に **前提（OS/バージョン/期待出力）**を明記推奨。

