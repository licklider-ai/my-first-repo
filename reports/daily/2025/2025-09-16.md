# 日報（YES/NO占いアプリ）
日付: 2025-09-16

## 1. 今日の目的
- 既存アプリに **回答ログのDB保存** と **アプリ内統計ダッシュボード** を追加
- Gitフロー（`feature → develop → master`）での反映／リリース準備

---

## 2. 実施内容（成果）
- フロント
  - メニュー右上に **「統計を見る」** ボタンを追加
  - `StatsView` を実装（クイズ別 YES/NO 合計、設問別内訳を表示）
  - 回答時に `/api/logs` へ **YES/NO を非同期POST**（クイズID・設問IDを付与）
  - `VITE_API_URL` で API ベースURLを外部化（未設定時は `http://localhost:8080`）
- サーバ/API（Node/Express）
  - 追加エンドポイント  
    - `POST /api/logs`（ログ保存）  
    - `GET  /api/stats/quiz/:quizId`（クイズ別 YES/NO 集計）  
    - `GET  /api/stats/question/:quizId`（設問別 YES/NO 内訳）  
    - `GET  /api/health`（疎通）
  - DB: PostgreSQL（テーブル `log_entries(id, quiz_id, question_id, answer, created_at)`）
- Docker
  - `web`（Vite Preview / 5173）、`api`（Express / 8080）、`db`（Postgres / 5432）で構成
  - `docker-compose.yml` で3サービス起動
- Git/ブランチ
  - `feature/stats-dashrd`（※実ブランチ名は環境の名称）で実装 → **PR: feature → develop**  
  - `App.tsx` のコンフリクトを解消（統計UI＋ログ送信を採用）  
  - `develop → master` のリリースPR作成（タイトル例: `release: v0.2.0`）

---

## 3. 詰まった点と対応
1) **WSL から zip をコピーできない**  
   - 誤パス（`/mnt/c/Users/<WinUser>/Downloads/...`）を正し、実ユーザー名でコピーして解決。  
   - 例: `cp "/mnt/c/Users/iwatu/Downloads/yesno-fortune-app.zip" .`

2) **`npm ci` 失敗（lock無し）**  
   - 初回は `npm i` を実行して `package-lock.json` 生成 → 以降 `npm ci` 使用。

3) **Vite のポート確認（5173/5174）**  
   - デフォルトの **5173** を採用。必要時は `--port 5174` や `vite.config.ts` で固定可能という方針を整理。

4) **Docker ビルド失敗（TS5097: `.tsx` import 拒否）**  
   - `src/main.tsx` の `import './App.tsx'` を **`import './App'`** に修正し解消。

5) **API に接続できない（:8080 が拒否）**  
   - `api` サービス未起動が原因。`docker compose up -d --build api` 実行。  
   - ログで `API on :8080` を確認、`/api/health` が `{"ok":true}` を返すことを確認。

6) **PR のコンフリクト（App.tsx）**  
   - GitHub の **Resolve conflicts** で `App.tsx` を**確定版へ置換**（統計UI＋ログ送信入り）。  
   - `Mark as resolved → Commit merge` 後に PR マージ。

---
